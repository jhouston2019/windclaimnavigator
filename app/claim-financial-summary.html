<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Summary - Claim Navigator AI</title>
  
  <!-- CRITICAL: Access guard must load first -->
  <script src="/app/assets/js/supabase-client.js"></script>
  <script src="/app/assets/js/auth.js" type="module"></script>
  <script src="/app/assets/js/access-guard.js"></script>
  
  <link rel="stylesheet" href="/app/assets/css/style.css">
  <link rel="stylesheet" href="/app/css/design-system.css">
  <script src="/storage/claimStorage.js"></script>
  <script src="/app/assets/js/navigation-template.js"></script>
  <style>
    body {
      background: #f8fafc;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
    }

    .page-header {
      background: linear-gradient(135deg, #0f1f3d 0%, #1e3a5f 100%);
      padding: 20px 40px;
      color: white;
      border-bottom: 1px solid #0a1628;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      margin: 0 0 6px 0;
      letter-spacing: -0.02em;
    }

    .page-subtitle {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
      margin: 0;
      font-weight: 400;
    }

    .content-area {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px 40px;
    }

    .summary-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
      border: 1px solid #d1d5db;
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: #0f172a;
      margin: 0 0 16px 0;
      padding-bottom: 10px;
      border-bottom: 2px solid #e5e7eb;
    }

    .summary-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .summary-table thead {
      background: #f8fafc;
    }

    .summary-table th {
      text-align: left;
      padding: 12px 16px;
      font-weight: 600;
      color: #475569;
      border-bottom: 2px solid #e5e7eb;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .summary-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #f1f5f9;
      color: #1e293b;
    }

    .summary-table tr:last-child td {
      border-bottom: none;
    }

    .summary-table tr:hover {
      background: #f8fafc;
    }

    .amount {
      font-weight: 600;
      font-size: 15px;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
    }

    .amount.positive {
      color: #059669;
    }

    .amount.negative {
      color: #dc2626;
    }

    .amount.neutral {
      color: #0f172a;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-complete {
      background: #d1fae5;
      color: #065f46;
    }

    .status-partial {
      background: #fef3c7;
      color: #92400e;
    }

    .status-incomplete {
      background: #fee2e2;
      color: #991b1b;
    }

    .status-pending {
      background: #dbeafe;
      color: #1e40af;
    }

    .status-paid {
      background: #d1fae5;
      color: #065f46;
    }

    .status-unpaid {
      background: #fee2e2;
      color: #991b1b;
    }

    .total-row td {
      font-weight: 700;
      font-size: 16px;
      background: #f8fafc;
      border-top: 2px solid #e5e7eb;
      padding-top: 16px;
      padding-bottom: 16px;
    }

    .info-note {
      background: #eff6ff;
      border-left: 4px solid #3b82f6;
      padding: 12px 16px;
      margin-top: 16px;
      border-radius: 6px;
      font-size: 13px;
      color: #1e40af;
    }

    .info-note strong {
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
    }

    .action-link {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
      font-size: 13px;
    }

    .action-link:hover {
      text-decoration: underline;
    }

    .export-buttons {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .btn:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      transform: translateY(-1px);
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-secondary {
      background: white;
      color: #475569;
      border: 1px solid #cbd5e1;
    }

    .btn-secondary:hover {
      background: #f8fafc;
    }

    .last-updated {
      text-align: center;
      color: #64748b;
      font-size: 12px;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
    }

    /* Claim Information Panel */
    .claim-info-panel {
      background: #1e3a8a;
      border: none;
      border-bottom: 1px solid #1e40af;
      border-radius: 0;
      padding: 0;
      margin-bottom: 0;
      box-shadow: none;
    }

    .claim-info-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 40px;
      cursor: pointer;
      transition: background 0.2s ease;
      border-bottom: none;
    }

    .claim-info-header:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .claim-info-title {
      font-size: 11px;
      font-weight: 600;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .claim-info-summary {
      font-size: 10px;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 400;
      margin-left: 8px;
    }

    .panel-toggle-icon {
      font-size: 10px;
      color: rgba(255, 255, 255, 0.7);
      transition: transform 0.2s ease;
      margin-left: 8px;
    }

    .claim-info-panel.expanded .panel-toggle-icon {
      transform: rotate(180deg);
    }

    .claim-info-content {
      display: none;
      padding: 8px 40px 12px 40px;
    }

    .claim-info-panel.expanded .claim-info-content {
      display: block;
    }

    .btn-edit {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 9px;
      font-weight: 600;
      color: #ffffff;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-edit:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
      color: #ffffff;
    }

    .claim-info-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .claim-info-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px 20px;
      margin-bottom: 0;
    }

    .claim-info-details {
      display: flex;
      flex-wrap: wrap;
      gap: 12px 20px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.15);
    }

    .claim-info-item {
      display: inline-flex;
      align-items: baseline;
      gap: 6px;
      white-space: nowrap;
    }

    .info-label {
      font-size: 10px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.6);
      text-transform: none;
      letter-spacing: 0;
    }

    .info-label::after {
      content: ':';
    }

    .info-value {
      font-size: 11px;
      font-weight: 600;
      color: #ffffff;
    }

    .info-value.urgent {
      color: #fbbf24;
      font-weight: 700;
    }

    .info-value.status-active {
      color: #60a5fa;
    }

    .deadline-alert {
      background: rgba(251, 191, 36, 0.15);
      border: 1px solid rgba(251, 191, 36, 0.4);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 11px;
      color: #fbbf24;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }

    .deadline-alert strong {
      font-weight: 700;
      color: #fbbf24;
    }

    /* Cash-First Hierarchy Summary Block */
    .cash-hierarchy-block {
      background: white;
      border-radius: 12px;
      padding: 32px 40px;
      margin: 0 auto 24px auto;
      max-width: 1400px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
      border: 1px solid #d1d5db;
      border-left: 6px solid #059669;
    }

    .cash-hierarchy-primary {
      margin-bottom: 20px;
    }

    .cash-hierarchy-label {
      font-size: 14px;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .cash-hierarchy-value {
      font-size: 48px;
      font-weight: 700;
      color: #059669;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      line-height: 1.1;
    }

    .cash-hierarchy-secondary {
      padding-top: 20px;
      border-top: 2px solid #e5e7eb;
      margin-bottom: 16px;
    }

    .cash-hierarchy-secondary-label {
      font-size: 13px;
      font-weight: 500;
      color: #94a3b8;
      margin-bottom: 6px;
    }

    .cash-hierarchy-secondary-value {
      font-size: 24px;
      font-weight: 600;
      color: #64748b;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
    }

    .cash-hierarchy-tertiary {
      display: none; /* Hidden by default, shown only if both values exist */
      padding-top: 16px;
      border-top: 1px solid #f1f5f9;
    }

    .cash-hierarchy-tertiary.visible {
      display: block;
    }

    .cash-hierarchy-tertiary-label {
      font-size: 12px;
      font-weight: 500;
      color: #94a3b8;
      margin-bottom: 4px;
    }

    .cash-hierarchy-tertiary-value {
      font-size: 18px;
      font-weight: 600;
      color: #475569;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .cash-hierarchy-block {
        padding: 24px 20px;
        margin: 0 20px 20px 20px;
      }

      .cash-hierarchy-value {
        font-size: 36px;
      }

      .cash-hierarchy-secondary-value {
        font-size: 20px;
      }

      .cash-hierarchy-tertiary-value {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <script>createNavigationBar('Financial Summary');</script>

  <!-- Page Header -->
  <header class="page-header">
    <h1 class="page-title">Financial Summary</h1>
    <p class="page-subtitle">Auto-computed financial position based on your claim documentation and carrier responses.</p>
  </header>

  <!-- Claim Information Panel -->
  <section class="claim-info-panel" id="claimInfoPanel">
    <div class="claim-info-header" onclick="toggleClaimInfoPanel()">
      <div>
        <h2 class="claim-info-title">
          Your Claim Information
          <span class="claim-info-summary">CLM-2024-089456 ‚Ä¢ State Farm</span>
          <span class="panel-toggle-icon">‚ñº</span>
        </h2>
      </div>
      <div class="claim-info-header-right">
        <button class="btn-edit" onclick="editClaimInfo(); event.stopPropagation();">‚úèÔ∏è Edit</button>
      </div>
    </div>
    <div class="claim-info-content">
      <div class="claim-info-grid">
        <div class="claim-info-item">
          <span class="info-label">Claim Number</span>
          <span class="info-value" id="claimNumber">CLM-2024-089456</span>
        </div>
        <div class="claim-info-item">
          <span class="info-label">Insurance Company</span>
          <span class="info-value" id="insurerName">State Farm</span>
        </div>
        <div class="claim-info-item">
          <span class="info-label">Claim Status</span>
          <span class="info-value status-active" id="claimStatus">Active - Under Review</span>
        </div>
      </div>
      <div class="claim-info-details expanded" id="claimDetails">
        <div class="claim-info-item">
          <span class="info-label">Date of Loss</span>
          <span class="info-value" id="dateOfLoss">November 15, 2024</span>
        </div>
        <div class="claim-info-item">
          <span class="info-label">Days Since Loss</span>
          <span class="info-value urgent" id="daysSinceLoss">45 days</span>
        </div>
        <div class="claim-info-item">
          <span class="info-label">Adjuster Name</span>
          <span class="info-value" id="adjusterName">Mike Johnson</span>
        </div>
      </div>
      <div class="deadline-alert">
        ‚ö†Ô∏è <strong>Upcoming Deadline</strong> Proof of Loss due in 15 days (January 14, 2025)
      </div>
    </div>
  </section>

  <!-- Cash-First Hierarchy Summary Block -->
  <div class="cash-hierarchy-block">
    <div class="cash-hierarchy-primary">
      <div class="cash-hierarchy-label">Claim Funds Collected to Date</div>
      <div class="cash-hierarchy-value" id="cashCollected">$0.00</div>
    </div>
    <div class="cash-hierarchy-secondary">
      <div class="cash-hierarchy-secondary-label">Estimated Total Damages (estimate)</div>
      <div class="cash-hierarchy-secondary-value" id="estimatedDamages">$0.00</div>
    </div>
    <div class="cash-hierarchy-tertiary" id="remainingPotential">
      <div class="cash-hierarchy-tertiary-label">Remaining Potential Claim Value</div>
      <div class="cash-hierarchy-tertiary-value" id="remainingValue">$0.00</div>
    </div>
  </div>

  <!-- Content Area -->
  <div class="content-area">

    <!-- Export Buttons -->
    <div class="export-buttons">
      <button class="btn btn-primary" onclick="exportToPDF()">üìÑ Export to PDF</button>
      <button class="btn btn-secondary" onclick="printSummary()">üñ®Ô∏è Print Summary</button>
      <button class="btn btn-secondary" onclick="refreshData()">üîÑ Refresh Data</button>
    </div>

    <!-- Table 1: Claim Position Summary -->
    <div class="summary-card">
      <h2 class="card-title">Claim Position Summary</h2>
      <table class="summary-table">
        <thead>
          <tr>
            <th>Metric</th>
            <th style="text-align: right;">Amount</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="claimPositionTable">
          <tr>
            <td>Documented Loss</td>
            <td style="text-align: right;"><span class="amount neutral" id="documentedLoss">$0.00</span></td>
            <td><span class="status-badge status-partial" id="documentedStatus">Partial</span></td>
          </tr>
          <tr>
            <td>Covered Loss (Eligible)</td>
            <td style="text-align: right;"><span class="amount neutral" id="coveredLoss">$0.00</span></td>
            <td><span class="status-badge status-pending" id="coveredStatus">Pending Review</span></td>
          </tr>
          <tr>
            <td>Deductible</td>
            <td style="text-align: right;"><span class="amount neutral" id="deductible">$0.00</span></td>
            <td><span class="status-badge status-complete" id="deductibleStatus">Policy Value</span></td>
          </tr>
          <tr>
            <td>Carrier Paid</td>
            <td style="text-align: right;"><span class="amount positive" id="carrierPaid">$0.00</span></td>
            <td><span class="status-badge status-paid" id="paidStatus">Paid</span></td>
          </tr>
          <tr class="total-row">
            <td>Outstanding Claim Gap</td>
            <td style="text-align: right;"><span class="amount negative" id="outstandingGap">$0.00</span></td>
            <td><span class="status-badge status-unpaid" id="gapStatus">Unpaid</span></td>
          </tr>
        </tbody>
      </table>
      <div class="info-note">
        <strong>Formula:</strong> Outstanding Gap = Covered Loss ‚àí Carrier Paid ‚àí Deductible
      </div>
    </div>

    <!-- Table 2: Loss Category Breakdown -->
    <div class="summary-card">
      <h2 class="card-title">Loss Category Breakdown</h2>
      <table class="summary-table">
        <thead>
          <tr>
            <th>Category</th>
            <th style="text-align: right;">Documented</th>
            <th style="text-align: right;">Covered</th>
            <th style="text-align: right;">Paid</th>
            <th style="text-align: right;">Recoverable</th>
            <th style="text-align: right;">Blocked</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="categoryBreakdownTable">
          <tr>
            <td><strong>Structure</strong></td>
            <td style="text-align: right;"><span class="amount neutral" id="structureDocumented">$0.00</span></td>
            <td style="text-align: right;"><span class="amount neutral" id="structureCovered">$0.00</span></td>
            <td style="text-align: right;"><span class="amount positive" id="structurePaid">$0.00</span></td>
            <td style="text-align: right;">‚Äî</td>
            <td style="text-align: right;"><span class="amount negative" id="structureBlocked">$0.00</span></td>
            <td><span class="status-badge status-partial" id="structureStatus">Partial</span></td>
          </tr>
          <tr>
            <td><strong>Contents</strong></td>
            <td style="text-align: right;"><span class="amount neutral" id="contentsDocumented">$0.00</span></td>
            <td style="text-align: right;"><span class="amount neutral" id="contentsCovered">$0.00</span></td>
            <td style="text-align: right;"><span class="amount positive" id="contentsPaid">$0.00</span></td>
            <td style="text-align: right;">‚Äî</td>
            <td style="text-align: right;"><span class="amount negative" id="contentsBlocked">$0.00</span></td>
            <td><span class="status-badge status-incomplete" id="contentsStatus">Not Started</span></td>
          </tr>
          <tr>
            <td><strong>ALE (Additional Living Expenses)</strong></td>
            <td style="text-align: right;"><span class="amount neutral" id="aleDocumented">$0.00</span></td>
            <td style="text-align: right;"><span class="amount neutral" id="aleCovered">$0.00</span></td>
            <td style="text-align: right;"><span class="amount positive" id="alePaid">$0.00</span></td>
            <td style="text-align: right;">‚Äî</td>
            <td style="text-align: right;"><span class="amount negative" id="aleBlocked">$0.00</span></td>
            <td><span class="status-badge status-incomplete" id="aleStatus">Not Started</span></td>
          </tr>
          <tr>
            <td><strong>Ordinance & Law</strong></td>
            <td style="text-align: right;"><span class="amount neutral" id="ordinanceDocumented">$0.00</span></td>
            <td style="text-align: right;"><span class="amount neutral" id="ordinanceCovered">$0.00</span></td>
            <td style="text-align: right;"><span class="amount positive" id="ordinancePaid">$0.00</span></td>
            <td style="text-align: right;">‚Äî</td>
            <td style="text-align: right;"><span class="amount negative" id="ordinanceBlocked">$0.00</span></td>
            <td><span class="status-badge status-incomplete" id="ordinanceStatus">Not Started</span></td>
          </tr>
          <tr>
            <td><strong>Depreciation (Withheld)</strong></td>
            <td style="text-align: right;">‚Äî</td>
            <td style="text-align: right;"><span class="amount neutral" id="depreciationCovered">$0.00</span></td>
            <td style="text-align: right;"><span class="amount positive" id="depreciationPaid">$0.00</span></td>
            <td style="text-align: right;"><span class="amount neutral" id="depreciationRecoverable">$0.00</span></td>
            <td style="text-align: right;">‚Äî</td>
            <td><span class="status-badge status-pending" id="depreciationStatus">Pending Receipts</span></td>
          </tr>
        </tbody>
      </table>
      <div class="info-note">
        <strong>Blocked:</strong> Amount that cannot be claimed due to missing documentation. <strong>Recoverable:</strong> Depreciation withheld pending replacement receipts.
      </div>
    </div>

    <!-- Table 3: Action ‚Üí Dollar Unlock Map -->
    <div class="summary-card">
      <h2 class="card-title">Action ‚Üí Dollar Unlock Map</h2>
      <table class="summary-table">
        <thead>
          <tr>
            <th>Missing Action</th>
            <th>Step</th>
            <th style="text-align: right;">Unlocks</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="actionUnlockTable">
          <tr>
            <td>Upload structure photos</td>
            <td>Step 3: Damage Documentation</td>
            <td style="text-align: right;"><span class="amount neutral">$0.00</span></td>
            <td><span class="status-badge status-incomplete">Incomplete</span></td>
            <td><a href="/step-by-step-claim-guide.html?step=3" class="action-link">Go to Step ‚Üí</a></td>
          </tr>
          <tr>
            <td>Complete contents inventory</td>
            <td>Step 8: Build Contents Inventory</td>
            <td style="text-align: right;"><span class="amount neutral">$0.00</span></td>
            <td><span class="status-badge status-incomplete">Not Started</span></td>
            <td><a href="/step-by-step-claim-guide.html?step=8" class="action-link">Go to Step ‚Üí</a></td>
          </tr>
          <tr>
            <td>Submit ALE receipts</td>
            <td>Step 7: ALE & Temporary Housing</td>
            <td style="text-align: right;"><span class="amount neutral">$0.00</span></td>
            <td><span class="status-badge status-incomplete">Not Started</span></td>
            <td><a href="/step-by-step-claim-guide.html?step=7" class="action-link">Go to Step ‚Üí</a></td>
          </tr>
          <tr>
            <td>Submit repair receipts</td>
            <td>Step 9: Contents Valuation</td>
            <td style="text-align: right;"><span class="amount neutral">$0.00</span></td>
            <td><span class="status-badge status-pending">Pending</span></td>
            <td><a href="/step-by-step-claim-guide.html?step=9" class="action-link">Go to Step ‚Üí</a></td>
          </tr>
          <tr>
            <td>Verify coverage alignment</td>
            <td>Step 6: Align Loss With Policy Coverage</td>
            <td style="text-align: right;"><span class="amount neutral">$0.00</span></td>
            <td><span class="status-badge status-incomplete">Incomplete</span></td>
            <td><a href="/step-by-step-claim-guide.html?step=6" class="action-link">Go to Step ‚Üí</a></td>
          </tr>
        </tbody>
      </table>
      <div class="info-note">
        <strong>Action Required:</strong> Complete these steps to unlock additional claim value and ensure full reimbursement.
      </div>
    </div>

    <!-- Table 4: Claim Timeline & Deadlines -->
    <div class="summary-card">
      <h2 class="card-title">Claim Timeline & Deadlines</h2>
      <table class="summary-table">
        <thead>
          <tr>
            <th>Event</th>
            <th>Date</th>
            <th>Days Ago</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="timelineTable">
          <tr>
            <td>Loss Date</td>
            <td id="lossDate">‚Äî</td>
            <td id="lossDaysAgo">‚Äî</td>
            <td><span class="status-badge status-complete">‚úì Recorded</span></td>
          </tr>
          <tr>
            <td>Notice of Loss</td>
            <td id="noticeDate">‚Äî</td>
            <td id="noticeDaysAgo">‚Äî</td>
            <td><span class="status-badge status-complete">‚úì Submitted</span></td>
          </tr>
          <tr>
            <td>Inspection Completed</td>
            <td id="inspectionDate">‚Äî</td>
            <td id="inspectionDaysAgo">‚Äî</td>
            <td><span class="status-badge status-complete">‚úì Completed</span></td>
          </tr>
          <tr>
            <td>Estimate Issued</td>
            <td id="estimateDate">‚Äî</td>
            <td id="estimateDaysAgo">‚Äî</td>
            <td><span class="status-badge status-partial">Partial</span></td>
          </tr>
          <tr>
            <td>Payment Issued</td>
            <td id="paymentDate">‚Äî</td>
            <td id="paymentDaysAgo">‚Äî</td>
            <td><span class="status-badge status-unpaid">Unpaid</span></td>
          </tr>
          <tr>
            <td>Proof of Loss Deadline</td>
            <td id="proofDeadline">‚Äî</td>
            <td id="proofDaysRemaining">‚Äî</td>
            <td><span class="status-badge status-pending">Pending</span></td>
          </tr>
          <tr>
            <td>Statutory Deadline</td>
            <td id="statutoryDeadline">‚Äî</td>
            <td id="statutoryDaysRemaining">‚Äî</td>
            <td><span class="status-badge status-pending">Pending</span></td>
          </tr>
        </tbody>
      </table>
      <div class="info-note">
        <strong>Critical Deadlines:</strong> Monitor proof of loss and statutory deadlines to preserve your claim rights.
      </div>
    </div>

    <!-- Last Updated -->
    <div class="last-updated">
      Last updated: <span id="lastUpdated">‚Äî</span> | Data auto-computed from claim steps
    </div>

  </div>

  <script>
    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2
      }).format(amount);
    }

    // Calculate days between dates
    function daysBetween(date1, date2) {
      const oneDay = 24 * 60 * 60 * 1000;
      return Math.round(Math.abs((date1 - date2) / oneDay));
    }

    // Load and compute financial data
    function loadFinancialData() {
      // Get claim state from storage
      const claimState = getClaimData('claimNavigatorState') || {};
      const claimInfo = claimState.claimInfo || {};
      
      // TABLE 1: Claim Position Summary
      const documentedLoss = 0; // Sum from all documented categories
      const coveredLoss = 0; // From policy alignment
      const deductible = 2500; // From policy
      const carrierPaid = 0; // From payment records
      const outstandingGap = coveredLoss - carrierPaid - deductible;

      // CASH-FIRST HIERARCHY SUMMARY BLOCK
      // Primary metric: Claim Funds Collected to Date (actual collected payments)
      document.getElementById('cashCollected').textContent = formatCurrency(carrierPaid);
      
      // Secondary metric: Estimated Total Damages (documented loss estimate)
      document.getElementById('estimatedDamages').textContent = formatCurrency(documentedLoss);
      
      // Tertiary metric: Remaining Potential Claim Value (only if both values exist)
      const remainingPotentialElement = document.getElementById('remainingPotential');
      if (documentedLoss > 0 && carrierPaid >= 0) {
        const remainingValue = documentedLoss - carrierPaid;
        document.getElementById('remainingValue').textContent = formatCurrency(remainingValue);
        remainingPotentialElement.classList.add('visible');
      } else {
        remainingPotentialElement.classList.remove('visible');
      }

      document.getElementById('documentedLoss').textContent = formatCurrency(documentedLoss);
      document.getElementById('coveredLoss').textContent = formatCurrency(coveredLoss);
      document.getElementById('deductible').textContent = formatCurrency(deductible);
      document.getElementById('carrierPaid').textContent = formatCurrency(carrierPaid);
      document.getElementById('outstandingGap').textContent = formatCurrency(outstandingGap);

      // TABLE 4: Timeline
      const lossDate = claimInfo.dateOfLoss || '‚Äî';
      document.getElementById('lossDate').textContent = lossDate;
      
      if (lossDate !== '‚Äî') {
        const lossDateObj = new Date(lossDate);
        const today = new Date();
        const daysAgo = daysBetween(today, lossDateObj);
        document.getElementById('lossDaysAgo').textContent = `${daysAgo} days ago`;
      }

      // Last updated
      document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
    }

    // Refresh data
    function refreshData() {
      loadFinancialData();
      alert('‚úì Financial data refreshed from claim steps');
    }

    // Export to PDF
    function exportToPDF() {
      window.print();
    }

    // Print summary
    function printSummary() {
      window.print();
    }

    // Toggle claim info panel
    function toggleClaimInfoPanel() {
      const panel = document.getElementById('claimInfoPanel');
      
      if (!panel) {
        console.error('Claim info panel not found');
        return;
      }
      
      const isExpanded = panel.classList.contains('expanded');
      
      if (isExpanded) {
        panel.classList.remove('expanded');
      } else {
        panel.classList.add('expanded');
      }
    }

    // Edit claim info (placeholder)
    function editClaimInfo() {
      alert('Edit claim information functionality coming soon.');
    }

    // Load data on page load
    document.addEventListener('DOMContentLoaded', loadFinancialData);
  </script>
</body>
</html>

