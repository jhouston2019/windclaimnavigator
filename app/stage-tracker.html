<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claim Stage Tracker - Claim Navigator</title>
  <meta name="description" content="Track your insurance claim progress through each stage with AI-powered guidance and next-step advice.">
  
  <link rel="stylesheet" href="/app/assets/css/tool-visual-alignment.css">
</head>
<body>
  <header>
    <nav>
      <div class="logo">Claim Navigator</div>
      <div class="nav-links">
        <a href="/">Home</a>
        <a href="/app/response-center.html">Response Center</a>
        <a href="/app/stage-tracker.html">Stage Tracker</a>
        <a href="/solution-center.html">Solution Center</a>
      </div>
    </nav>
  </header>

  <div class="main-content">
    <div class="page-header">
      <h1>Claim Stage Tracker</h1>
      <p>Track your insurance claim progress through each stage with AI-powered guidance and personalized next-step advice.</p>
    </div>

    <!-- Language Toggle -->
    <div class="language-toggle">
      <button class="lang-btn active" onclick="setLanguage('en')">English</button>
      <button class="lang-btn" onclick="setLanguage('es')">Espa침ol</button>
    </div>

    <!-- Claim Type Selector -->
    <div class="claim-type-selector">
      <h2 data-i18n="claimTypeTitle">Select Your Claim Type</h2>
      <p data-i18n="claimTypeDesc">Choose the type of insurance claim you're tracking to get personalized advice.</p>
      <div class="claim-type-grid">
        <button class="claim-type-btn" onclick="selectClaimType('property')" data-i18n="propertyDamage">Property Damage</button>
        <button class="claim-type-btn" onclick="selectClaimType('auto')" data-i18n="autoAccident">Auto Accident</button>
        <button class="claim-type-btn" onclick="selectClaimType('health')" data-i18n="healthInsurance">Health Insurance</button>
        <button class="claim-type-btn" onclick="selectClaimType('business')" data-i18n="businessClaim">Business Claim</button>
      </div>
    </div>

    <!-- Progress Tracker -->
    <div class="progress-container">
      <div class="progress-header">
        <h2 data-i18n="progressTitle">Your Claim Progress</h2>
        <p data-i18n="progressDesc">Track your progress through each stage of the claims process.</p>
      </div>
      
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div class="stages-container">
        <!-- Stage 1: Filed -->
        <div class="stage-card not-started" data-stage="filed" onclick="toggleStage('filed')">
          <div class="stage-header">
            <div class="stage-number not-started">1</div>
            <div class="stage-title" data-i18n="stageFiled">Filed</div>
            <div class="stage-status not-started" data-i18n="notStarted">Not Started</div>
          </div>
          <div class="stage-description" data-i18n="stageFiledDesc">
            Initial claim submission with your insurance company.
          </div>
          <div class="stage-actions">
            <button class="btn btn-primary" onclick="getStageAdvice('filed')" data-i18n="getAdvice">Get AI Advice</button>
            <button class="btn btn-secondary" onclick="markStage('filed', 'in_progress')" data-i18n="markInProgress">Mark In Progress</button>
          </div>
        </div>

        <!-- Stage 2: Inspection -->
        <div class="stage-card not-started" data-stage="inspection" onclick="toggleStage('inspection')">
          <div class="stage-header">
            <div class="stage-number not-started">2</div>
            <div class="stage-title" data-i18n="stageInspection">Inspection</div>
            <div class="stage-status not-started" data-i18n="notStarted">Not Started</div>
          </div>
          <div class="stage-description" data-i18n="stageInspectionDesc">
            Insurance adjuster evaluates the damage and determines coverage.
          </div>
          <div class="stage-actions">
            <button class="btn btn-primary" onclick="getStageAdvice('inspection')" data-i18n="getAdvice">Get AI Advice</button>
            <button class="btn btn-secondary" onclick="markStage('inspection', 'in_progress')" data-i18n="markInProgress">Mark In Progress</button>
          </div>
        </div>

        <!-- Stage 3: Offer -->
        <div class="stage-card not-started" data-stage="offer" onclick="toggleStage('offer')">
          <div class="stage-header">
            <div class="stage-number not-started">3</div>
            <div class="stage-title" data-i18n="stageOffer">Offer</div>
            <div class="stage-status not-started" data-i18n="notStarted">Not Started</div>
          </div>
          <div class="stage-description" data-i18n="stageOfferDesc">
            Insurance company presents their settlement offer.
          </div>
          <div class="stage-actions">
            <button class="btn btn-primary" onclick="getStageAdvice('offer')" data-i18n="getAdvice">Get AI Advice</button>
            <button class="btn btn-secondary" onclick="markStage('offer', 'in_progress')" data-i18n="markInProgress">Mark In Progress</button>
          </div>
        </div>

        <!-- Stage 4: Appeal -->
        <div class="stage-card not-started" data-stage="appeal" onclick="toggleStage('appeal')">
          <div class="stage-header">
            <div class="stage-number not-started">4</div>
            <div class="stage-title" data-i18n="stageAppeal">Appeal</div>
            <div class="stage-status not-started" data-i18n="notStarted">Not Started</div>
          </div>
          <div class="stage-description" data-i18n="stageAppealDesc">
            Challenge the insurance company's decision if needed.
          </div>
          <div class="stage-actions">
            <button class="btn btn-primary" onclick="getStageAdvice('appeal')" data-i18n="getAdvice">Get AI Advice</button>
            <button class="btn btn-secondary" onclick="markStage('appeal', 'in_progress')" data-i18n="markInProgress">Mark In Progress</button>
          </div>
        </div>

        <!-- Stage 5: Settlement -->
        <div class="stage-card not-started" data-stage="settlement" onclick="toggleStage('settlement')">
          <div class="stage-header">
            <div class="stage-number not-started">5</div>
            <div class="stage-title" data-i18n="stageSettlement">Settlement</div>
            <div class="stage-status not-started" data-i18n="notStarted">Not Started</div>
          </div>
          <div class="stage-description" data-i18n="stageSettlementDesc">
            Final resolution and payment of your claim.
          </div>
          <div class="stage-actions">
            <button class="btn btn-primary" onclick="getStageAdvice('settlement')" data-i18n="getAdvice">Get AI Advice</button>
            <button class="btn btn-secondary" onclick="markStage('settlement', 'in_progress')" data-i18n="markInProgress">Mark In Progress</button>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Advice Section -->
    <div class="advice-container" id="adviceContainer" style="display: none;">
      <div class="advice-header">
        <div class="advice-icon">游뱄</div>
        <div class="advice-title" data-i18n="aiAdviceTitle">AI-Powered Stage Advice</div>
      </div>
      <div class="advice-content" id="adviceContent">
        <!-- AI advice will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentLanguage = 'en';
    let selectedClaimType = null;
    let stageStatuses = {
      filed: 'not_started',
      inspection: 'not_started',
      offer: 'not_started',
      appeal: 'not_started',
      settlement: 'not_started'
    };

    // Language and localization
    const translations = {
      en: {
        claimTypeTitle: "Select Your Claim Type",
        claimTypeDesc: "Choose the type of insurance claim you're tracking to get personalized advice.",
        propertyDamage: "Property Damage",
        autoAccident: "Auto Accident",
        healthInsurance: "Health Insurance",
        businessClaim: "Business Claim",
        progressTitle: "Your Claim Progress",
        progressDesc: "Track your progress through each stage of the claims process.",
        notStarted: "Not Started",
        stageFiled: "Filed",
        stageFiledDesc: "Initial claim submission with your insurance company.",
        stageInspection: "Inspection",
        stageInspectionDesc: "Insurance adjuster evaluates the damage and determines coverage.",
        stageOffer: "Offer",
        stageOfferDesc: "Insurance company presents their settlement offer.",
        stageAppeal: "Appeal",
        stageAppealDesc: "Challenge the insurance company's decision if needed.",
        stageSettlement: "Settlement",
        stageSettlementDesc: "Final resolution and payment of your claim.",
        getAdvice: "Get AI Advice",
        markInProgress: "Mark In Progress",
        markCompleted: "Mark Completed",
        aiAdviceTitle: "AI-Powered Stage Advice",
        inProgress: "In Progress",
        completed: "Completed"
      },
      es: {
        claimTypeTitle: "Selecciona el Tipo de Reclamo",
        claimTypeDesc: "Elige el tipo de reclamo de seguro que est치s rastreando para obtener consejos personalizados.",
        propertyDamage: "Da침os a la Propiedad",
        autoAccident: "Accidente Automovil칤stico",
        healthInsurance: "Seguro de Salud",
        businessClaim: "Reclamo Comercial",
        progressTitle: "Progreso de tu Reclamo",
        progressDesc: "Rastrea tu progreso a trav칠s de cada etapa del proceso de reclamos.",
        notStarted: "No Iniciado",
        stageFiled: "Presentado",
        stageFiledDesc: "Presentaci칩n inicial del reclamo con tu compa침칤a de seguros.",
        stageInspection: "Inspecci칩n",
        stageInspectionDesc: "El ajustador de seguros eval칰a los da침os y determina la cobertura.",
        stageOffer: "Oferta",
        stageOfferDesc: "La compa침칤a de seguros presenta su oferta de liquidaci칩n.",
        stageAppeal: "Apelaci칩n",
        stageAppealDesc: "Impugnar la decisi칩n de la compa침칤a de seguros si es necesario.",
        stageSettlement: "Liquidaci칩n",
        stageSettlementDesc: "Resoluci칩n final y pago de tu reclamo.",
        getAdvice: "Obtener Consejo IA",
        markInProgress: "Marcar En Progreso",
        markCompleted: "Marcar Completado",
        aiAdviceTitle: "Consejo de Etapa con IA",
        inProgress: "En Progreso",
        completed: "Completado"
      }
    };

    // Set language
    function setLanguage(lang) {
      currentLanguage = lang;
      
      // Update language buttons
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Update all text elements
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
          element.textContent = translations[lang][key];
        }
      });
      
      // Save language preference
      localStorage.setItem('stageTrackerLang', lang);
    }

    // Select claim type
    function selectClaimType(type) {
      selectedClaimType = type;
      
      // Update claim type buttons
      document.querySelectorAll('.claim-type-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      event.target.classList.add('selected');
      
      // Save selection
      localStorage.setItem('stageTrackerClaimType', type);
    }

    // Toggle stage status
    function toggleStage(stage) {
      const card = document.querySelector(`[data-stage="${stage}"]`);
      const currentStatus = stageStatuses[stage];
      
      let newStatus;
      if (currentStatus === 'not_started') {
        newStatus = 'in_progress';
      } else if (currentStatus === 'in_progress') {
        newStatus = 'completed';
      } else {
        newStatus = 'not_started';
      }
      
      markStage(stage, newStatus);
    }

    // Mark stage status
    function markStage(stage, status) {
      stageStatuses[stage] = status;
      
      const card = document.querySelector(`[data-stage="${stage}"]`);
      const number = card.querySelector('.stage-number');
      const statusElement = card.querySelector('.stage-status');
      const actions = card.querySelector('.stage-actions');
      
      // Update card appearance
      card.className = `stage-card ${status}`;
      number.className = `stage-number ${status}`;
      statusElement.className = `stage-status ${status}`;
      
      // Update status text
      const statusText = status === 'not_started' ? 
        translations[currentLanguage].notStarted :
        status === 'in_progress' ? 
        translations[currentLanguage].inProgress :
        translations[currentLanguage].completed;
      statusElement.textContent = statusText;
      
      // Update action buttons
      if (status === 'completed') {
        actions.innerHTML = `
          <button class="btn btn-success" onclick="markStage('${stage}', 'not_started')" data-i18n="markInProgress">Reset Stage</button>
        `;
      } else if (status === 'in_progress') {
        actions.innerHTML = `
          <button class="btn btn-primary" onclick="getStageAdvice('${stage}')" data-i18n="getAdvice">Get AI Advice</button>
          <button class="btn btn-success" onclick="markStage('${stage}', 'completed')" data-i18n="markCompleted">Mark Completed</button>
        `;
      } else {
        actions.innerHTML = `
          <button class="btn btn-primary" onclick="getStageAdvice('${stage}')" data-i18n="getAdvice">Get AI Advice</button>
          <button class="btn btn-secondary" onclick="markStage('${stage}', 'in_progress')" data-i18n="markInProgress">Mark In Progress</button>
        `;
      }
      
      // Update progress bar
      updateProgressBar();
      
      // Save to localStorage
      localStorage.setItem('stageTrackerStatuses', JSON.stringify(stageStatuses));
    }

    // Update progress bar
    function updateProgressBar() {
      const completedStages = Object.values(stageStatuses).filter(status => status === 'completed').length;
      const totalStages = Object.keys(stageStatuses).length;
      const progressPercentage = (completedStages / totalStages) * 100;
      
      document.getElementById('progressFill').style.width = `${progressPercentage}%`;
    }

    // Get AI advice for stage
    async function getStageAdvice(stage) {
      if (!selectedClaimType) {
        alert(translations[currentLanguage].selectClaimType || 'Please select a claim type first.');
        return;
      }
      
      const adviceContainer = document.getElementById('adviceContainer');
      const adviceContent = document.getElementById('adviceContent');
      
      // Show loading state
      adviceContainer.style.display = 'block';
      adviceContent.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <span>${translations[currentLanguage].loading || 'Loading AI advice...'}</span>
        </div>
      `;
      
      try {
        const response = await fetch('/netlify/functions/getStageAdvice', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            stage: stage,
            claimType: selectedClaimType,
            language: currentLanguage
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          // Display AI advice
          adviceContent.innerHTML = `
            <div style="white-space: pre-wrap; line-height: 1.6;">
              ${data.advice}
            </div>
          `;
        } else {
          throw new Error(data.error || 'Failed to get advice');
        }
      } catch (error) {
        console.error('Error getting AI advice:', error);
        adviceContent.innerHTML = `
          <div >
            <h3>Error Loading AI Advice</h3>
            <p>${error.message}</p>
            <p>Please try again later or contact support if the problem persists.</p>
          </div>
        `;
      }
    }

    // Initialize page
    function initializePage() {
      // Load saved language
      const savedLang = localStorage.getItem('stageTrackerLang') || 'en';
      setLanguage(savedLang);
      
      // Load saved claim type
      const savedClaimType = localStorage.getItem('stageTrackerClaimType');
      if (savedClaimType) {
        selectedClaimType = savedClaimType;
        const claimTypeBtn = document.querySelector(`[onclick="selectClaimType('${savedClaimType}')"]`);
        if (claimTypeBtn) {
          claimTypeBtn.classList.add('selected');
        }
      }
      
      // Load saved stage statuses
      const savedStatuses = localStorage.getItem('stageTrackerStatuses');
      if (savedStatuses) {
        stageStatuses = JSON.parse(savedStatuses);
        
        // Update UI to reflect saved statuses
        Object.keys(stageStatuses).forEach(stage => {
          if (stageStatuses[stage] !== 'not_started') {
            markStage(stage, stageStatuses[stage]);
          }
        });
      }
      
      // Update progress bar
      updateProgressBar();
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', initializePage);
  </script>
<script type="module" src="/app/assets/js/diagnostics.js"></script>
<script type="module" src="/app/assets/js/window-bridge.js"></script>
</body>
</html>
