<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workflow Tool - Claim Navigator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/app/assets/css/tool-visual-alignment.css">
  <link rel="stylesheet" href="/app/assets/css/workflow-tools-ai.css">
  
  <!-- CRITICAL: Load auth and paywall BEFORE any other scripts -->
  <script src="/app/assets/js/supabase-client.js"></script>
  <script src="/app/assets/js/auth.js" type="module"></script>
  <script src="/app/assets/js/paywall-enforcement.js"></script>
  
  <script src="storage/claimStorage.js"></script>
  <script src="/app/assets/js/tool-registry.js"></script>
  <script src="/app/assets/js/workflow-tools-ai.js"></script>
  
  <!-- BLOCKING GUARD: Hide content until access verified -->
  <script src="/app/assets/js/access-guard.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --navy-primary: #0B2545;
      --navy-dark: #0B2545;
      --navy-light: #123A63;
      --teal-primary: #17BEBB;
      --teal-hover: #13a09d;
      --bg-page: #ffffff;
      --bg-white: #ffffff;
      --bg-light: #F7F9FC;
      --bg-card: #ffffff;
      --bg-card-hover: #F7F9FC;
      --border-light: #e5e7eb;
      --border-medium: #d1d5db;
      --border-dark: #9ca3af;
      --text-primary: #1f2937;
      --text-secondary: #4b5563;
      --text-muted: #6b7280;
      --text-white: #ffffff;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-red: #ef4444;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-light);
      color: var(--text-primary);
      line-height: 1.6;
    }

    /* Global Navigation Header */
    .global-header {
      background: linear-gradient(135deg, #0B2545 0%, #123A63 100%);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .global-nav {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 20px;
    }

    .nav-brand {
      font-size: 1.125rem;
      font-weight: 700;
      color: #ffffff;
      text-decoration: none;
    }

    .nav-back {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s ease;
    }

    .nav-back:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Main Container */
    .tool-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    /* Tool Header */
    .tool-header {
      background: white;
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-sm);
    }

    .tool-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--navy-primary);
      margin-bottom: 12px;
    }

    .tool-description {
      font-size: 16px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .tool-meta {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-light);
    }

    .tool-meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .tool-meta-icon {
      font-size: 18px;
    }

    /* Tool Content */
    .tool-content {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: var(--shadow-sm);
      margin-bottom: 24px;
    }

    .tool-section {
      margin-bottom: 32px;
    }

    .tool-section:last-child {
      margin-bottom: 0;
    }

    .tool-section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--navy-primary);
      margin-bottom: 16px;
    }

    .tool-section-description {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--border-medium);
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s ease;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--teal-primary);
      box-shadow: 0 0 0 3px rgba(23, 190, 187, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    /* File Upload */
    .file-upload-area {
      border: 2px dashed var(--border-medium);
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .file-upload-area:hover {
      border-color: var(--teal-primary);
      background: var(--bg-light);
    }

    .file-upload-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .file-upload-text {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .file-upload-input {
      display: none;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--teal-primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--teal-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--bg-light);
      color: var(--text-primary);
      border: 1px solid var(--border-medium);
    }

    .btn-secondary:hover {
      background: var(--bg-card-hover);
    }

    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    /* Data Table */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }

    .data-table th,
    .data-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }

    .data-table th {
      background: var(--bg-light);
      font-weight: 600;
      font-size: 13px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .data-table td {
      font-size: 14px;
    }

    .data-table tr:hover {
      background: var(--bg-light);
    }

    /* Status Badge */
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-badge.success {
      background: #d1fae5;
      color: #065f46;
    }

    .status-badge.warning {
      background: #fef3c7;
      color: #92400e;
    }

    .status-badge.error {
      background: #fee2e2;
      color: #991b1b;
    }

    .status-badge.info {
      background: #dbeafe;
      color: #1e40af;
    }

    /* Alert Box */
    .alert {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .alert-info {
      background: #dbeafe;
      border: 1px solid #93c5fd;
      color: #1e40af;
    }

    .alert-warning {
      background: #fef3c7;
      border: 1px solid #fcd34d;
      color: #92400e;
    }

    .alert-success {
      background: #d1fae5;
      border: 1px solid #6ee7b7;
      color: #065f46;
    }

    .alert-error {
      background: #fee2e2;
      border: 1px solid #fca5a5;
      color: #991b1b;
    }

    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .empty-state-description {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .tool-container {
        padding: 20px 16px;
      }

      .tool-header,
      .tool-content {
        padding: 24px;
      }

      .tool-title {
        font-size: 24px;
      }

      .tool-meta {
        flex-direction: column;
        gap: 12px;
      }

      .btn-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <!-- Global Navigation -->
  <header class="global-header">
    <nav class="global-nav">
      <a href="/step-by-step-claim-guide.html" class="nav-brand">Claim Navigator</a>
      <a href="javascript:history.back()" class="nav-back">
        <span>‚Üê</span>
        <span>Back to Guide</span>
      </a>
    </nav>
  </header>

  <!-- Main Container -->
  <div class="tool-container">
    <!-- Tool Header -->
    <div class="tool-header">
      <h1 class="tool-title" id="tool-title">Loading Tool...</h1>
      <p class="tool-description" id="tool-description">Please wait while we load the tool...</p>
      <div class="tool-meta">
        <div class="tool-meta-item">
          <span class="tool-meta-icon">üìã</span>
          <span id="tool-step">Step --</span>
        </div>
        <div class="tool-meta-item">
          <span class="tool-meta-icon">üè∑Ô∏è</span>
          <span id="tool-classification">--</span>
        </div>
      </div>
    </div>

    <!-- Tool Content -->
    <div class="tool-content">
      <div id="tool-interface">
        <!-- Tool-specific interface will be loaded here -->
        <div class="empty-state">
          <div class="empty-state-icon">‚è≥</div>
          <div class="empty-state-title">Loading Tool Interface</div>
          <div class="empty-state-description">Please wait...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Assistant Container (will be injected by workflow-tools-ai.js) -->
  <div id="ai-assistant-container"></div>

  <script>
    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const toolId = urlParams.get('toolId') || urlParams.get('tool');
    const stepNum = urlParams.get('step');
    const returnUrl = urlParams.get('return');

    // Tool metadata and interfaces
    const TOOL_METADATA = {
      'acknowledgment-status-view': {
        title: 'Acknowledgment Status View',
        description: 'Track your claim submission acknowledgment status and follow-up requirements.',
        step: 11,
        classification: 'Required'
      },
      'method-timestamp-view': {
        title: 'Method & Timestamp View',
        description: 'View your submission method and timestamp documentation.',
        step: 11,
        classification: 'Required'
      },
      'followup-schedule-view': {
        title: 'Follow-up Schedule View',
        description: 'Manage your claim follow-up schedule and track carrier responsiveness.',
        step: 11,
        classification: 'Required'
      },
      'submission-method': {
        title: 'Submission Method Selector',
        description: 'Choose and configure your claim submission method.',
        step: 11,
        classification: 'Required'
      },
      'claim-submitter': {
        title: 'Claim Submitter',
        description: 'Submit your complete claim package to your insurance carrier.',
        step: 11,
        classification: 'Required'
      },
      'ale-tracker': {
        title: 'ALE Tracker & Validator',
        description: 'Track and validate Additional Living Expenses for maximum recovery.',
        step: 6,
        classification: 'Required'
      },
      'expense-upload-tool': {
        title: 'Expense Upload Tool',
        description: 'Upload and organize your expense receipts and documentation.',
        step: 6,
        classification: 'Required'
      },
      'temporary-housing-documentation-helper': {
        title: 'Temporary Housing Documentation Helper',
        description: 'Document your temporary housing arrangements and costs.',
        step: 6,
        classification: 'Optional'
      },
      'carrier-request-logger': {
        title: 'Carrier Request Logger',
        description: 'Log and analyze carrier information requests and demands.',
        step: 12,
        classification: 'Required'
      },
      'deadline-response-tracker': {
        title: 'Deadline & Response Tracker',
        description: 'Track all claim deadlines and response requirements.',
        step: 12,
        classification: 'Required'
      },
      'document-production-checklist': {
        title: 'Document Production Checklist',
        description: 'Manage document production requests and responses.',
        step: 12,
        classification: 'Optional'
      },
      'claim-package-assembly': {
        title: 'Claim Package Assembly',
        description: 'Assemble and organize your complete claim submission package.',
        step: 10,
        classification: 'Required'
      },
      'compliance-auto-import': {
        title: 'Compliance Auto Import',
        description: 'Import and analyze policy compliance requirements.',
        step: 2,
        classification: 'Required'
      },
      'compliance-review': {
        title: 'Compliance Review',
        description: 'Review your compliance status with all policy duties.',
        step: 2,
        classification: 'Required'
      },
      'compliance-report-viewer': {
        title: 'Compliance Report Viewer',
        description: 'View and interpret your compliance status report.',
        step: 2,
        classification: 'Required'
      },
      'mitigation-documentation-tool': {
        title: 'Mitigation Documentation Tool',
        description: 'Document your property damage mitigation efforts.',
        step: 2,
        classification: 'Required'
      },
      'proof-of-loss-tracker': {
        title: 'Proof of Loss Tracker',
        description: 'Track and prepare your Proof of Loss statement.',
        step: 2,
        classification: 'Required'
      },
      'damage-documentation-tool': {
        title: 'Damage Documentation Tool',
        description: 'Document all property damage with photos and descriptions.',
        step: 3,
        classification: 'Required'
      },
      'damage-labeling-tool': {
        title: 'Damage Labeling Tool',
        description: 'Label and organize your damage photos.',
        step: 3,
        classification: 'Optional'
      },
      'damage-report-viewer': {
        title: 'Damage Report Viewer',
        description: 'View and analyze your damage documentation report.',
        step: 3,
        classification: 'Required'
      },
      'photo-upload-organizer': {
        title: 'Photo Upload Organizer',
        description: 'Upload and organize your claim photos.',
        step: 3,
        classification: 'Required'
      },
      'contents-inventory': {
        title: 'Contents Inventory',
        description: 'Create a comprehensive inventory of damaged personal property.',
        step: 7,
        classification: 'Required'
      },
      'contents-documentation-helper': {
        title: 'Contents Documentation Helper',
        description: 'Document item details and proof of ownership.',
        step: 7,
        classification: 'Optional'
      },
      'room-by-room-prompt-tool': {
        title: 'Room by Room Prompt Tool',
        description: 'Use room-by-room prompts to create complete inventories.',
        step: 7,
        classification: 'Optional'
      },
      'contractor-scope-checklist': {
        title: 'Contractor Scope Checklist',
        description: 'Review contractor repair scopes for completeness.',
        step: 4,
        classification: 'Optional'
      },
      'coverage-mapping-visualizer': {
        title: 'Coverage Mapping Visualizer',
        description: 'Map your damage to applicable policy coverage provisions.',
        step: 9,
        classification: 'Required'
      },
      'policy-report-viewer': {
        title: 'Policy Report Viewer',
        description: 'View and analyze your insurance policy report.',
        step: 1,
        classification: 'Required'
      },
      'policy-uploader': {
        title: 'Policy Uploader',
        description: 'Upload your insurance policy documents for AI analysis.',
        step: 1,
        classification: 'Required'
      },
      'download-policy-report': {
        title: 'Download Policy Report',
        description: 'Download your policy analysis report.',
        step: 1,
        classification: 'Optional'
      },
      'download-submission-report': {
        title: 'Download Submission Report',
        description: 'Download your claim submission report.',
        step: 11,
        classification: 'Optional'
      },
      'step1-acknowledgment': {
        title: 'Step 1 Acknowledgment',
        description: 'Acknowledge completion of Step 1 - Policy Review.',
        step: 1,
        classification: 'Required'
      },
      'step2-acknowledgment': {
        title: 'Step 2 Acknowledgment',
        description: 'Acknowledge completion of Step 2 - Compliance Review.',
        step: 2,
        classification: 'Required'
      },
      'step3-acknowledgment': {
        title: 'Step 3 Acknowledgment',
        description: 'Acknowledge completion of Step 3 - Damage Documentation.',
        step: 3,
        classification: 'Required'
      },
      'step11-acknowledgment': {
        title: 'Step 11 Acknowledgment',
        description: 'Acknowledge completion of Step 11 - Claim Submission.',
        step: 11,
        classification: 'Required'
      },
      'step11-next-moves': {
        title: 'Step 11 Next Moves',
        description: 'Plan your next steps after claim submission.',
        step: 11,
        classification: 'Optional'
      }
    };

    // Initialize tool
    function initializeTool() {
      if (!toolId) {
        showError('No tool specified');
        return;
      }

      const metadata = TOOL_METADATA[toolId];
      if (!metadata) {
        showError(`Tool "${toolId}" not found`);
        return;
      }

      // Update header
      document.getElementById('tool-title').textContent = metadata.title;
      document.getElementById('tool-description').textContent = metadata.description;
      document.getElementById('tool-step').textContent = `Step ${metadata.step}`;
      document.getElementById('tool-classification').textContent = metadata.classification;
      document.title = `${metadata.title} - Claim Navigator`;

      // Load tool interface
      loadToolInterface(toolId, metadata);

      // Initialize AI assistant
      const aiContainer = document.getElementById('ai-assistant-container');
      if (aiContainer && window.createWorkflowToolAI) {
        window.createWorkflowToolAI(toolId, aiContainer);
      }
    }

    // Load tool-specific interface
    function loadToolInterface(toolId, metadata) {
      const interfaceContainer = document.getElementById('tool-interface');
      
      // Create a basic interface for each tool type
      // This is a simplified version - you can expand with tool-specific functionality
      
      interfaceContainer.innerHTML = `
        <div class="tool-section">
          <h2 class="tool-section-title">Tool Interface</h2>
          <p class="tool-section-description">This tool helps you with ${metadata.description.toLowerCase()}</p>
          
          <div class="alert alert-info">
            <strong>üí° Tip:</strong> Use the AI Assistant (bottom right) to get help with this tool!
          </div>
          
          <div class="form-group">
            <label class="form-label">Notes / Information</label>
            <textarea class="form-textarea" id="tool-notes" placeholder="Enter your notes or information here..."></textarea>
            <div class="form-hint">Your notes will be saved automatically</div>
          </div>
          
          <div class="btn-group">
            <button class="btn btn-primary" onclick="saveTool()">
              <span>üíæ</span>
              <span>Save</span>
            </button>
            <button class="btn btn-secondary" onclick="window.history.back()">
              <span>‚Üê</span>
              <span>Back to Guide</span>
            </button>
          </div>
        </div>
      `;
      
      // Load saved data if exists
      loadSavedData(toolId);
    }

    // Save tool data
    function saveTool() {
      const notes = document.getElementById('tool-notes')?.value || '';
      
      const data = {
        toolId: toolId,
        notes: notes,
        timestamp: new Date().toISOString()
      };
      
      // Save to localStorage
      localStorage.setItem(`tool_${toolId}_data`, JSON.stringify(data));
      
      // Show success message
      showSuccess('Tool data saved successfully!');
    }

    // Load saved data
    function loadSavedData(toolId) {
      const savedData = localStorage.getItem(`tool_${toolId}_data`);
      if (savedData) {
        try {
          const data = JSON.parse(savedData);
          const notesField = document.getElementById('tool-notes');
          if (notesField && data.notes) {
            notesField.value = data.notes;
          }
        } catch (error) {
          console.error('Error loading saved data:', error);
        }
      }
    }

    // Show error
    function showError(message) {
      const interfaceContainer = document.getElementById('tool-interface');
      interfaceContainer.innerHTML = `
        <div class="alert alert-error">
          <strong>Error:</strong> ${message}
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="window.history.back()">
            <span>‚Üê</span>
            <span>Back to Guide</span>
          </button>
        </div>
      `;
    }

    // Show success message
    function showSuccess(message) {
      // Create temporary success message
      const successDiv = document.createElement('div');
      successDiv.className = 'alert alert-success';
      successDiv.style.position = 'fixed';
      successDiv.style.top = '20px';
      successDiv.style.right = '20px';
      successDiv.style.zIndex = '10000';
      successDiv.style.animation = 'slideIn 0.3s ease';
      successDiv.innerHTML = `<strong>‚úì</strong> ${message}`;
      
      document.body.appendChild(successDiv);
      
      setTimeout(() => {
        successDiv.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => successDiv.remove(), 300);
      }, 3000);
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initializeTool);
  </script>
</body>
</html>


